<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Mysql优化 | 只非鱼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="只非鱼,hjq,只非鱼博客" />
  
  <meta name="description" content="目录1.Mysql优化 1.1 表的设计要合理(满足3NF)3范式 1.2 创建适当索引[主键索引|唯一索引|普通索引|全文索引|空间索引] 1.3 对SQL语句优化 -&amp;gt; 定位慢查询(explain(工具)) 1.4 使用分表技术(重点【水平分表、垂直分表】), 分区技术（了解） 1.5 读写分离（只要配置即可） 1.6 创建适当存储过程、函数、触发器 1.7 对my.ini优化，优化配置">
<meta name="keywords" content="PHP">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql优化">
<meta property="og:url" content="https://jqhee.github.io/2018/05/09/PHP/Mysql优化/index.html">
<meta property="og:site_name" content="只非鱼">
<meta property="og:description" content="目录1.Mysql优化 1.1 表的设计要合理(满足3NF)3范式 1.2 创建适当索引[主键索引|唯一索引|普通索引|全文索引|空间索引] 1.3 对SQL语句优化 -&amp;gt; 定位慢查询(explain(工具)) 1.4 使用分表技术(重点【水平分表、垂直分表】), 分区技术（了解） 1.5 读写分离（只要配置即可） 1.6 创建适当存储过程、函数、触发器 1.7 对my.ini优化，优化配置">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-05-14T02:27:01.491Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mysql优化">
<meta name="twitter:description" content="目录1.Mysql优化 1.1 表的设计要合理(满足3NF)3范式 1.2 创建适当索引[主键索引|唯一索引|普通索引|全文索引|空间索引] 1.3 对SQL语句优化 -&amp;gt; 定位慢查询(explain(工具)) 1.4 使用分表技术(重点【水平分表、垂直分表】), 分区技术（了解） 1.5 读写分离（只要配置即可） 1.6 创建适当存储过程、函数、触发器 1.7 对my.ini优化，优化配置">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>

<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">只非鱼博客</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>首页</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>档案</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        只非鱼博客
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个专注 全栈 开发的技术博客
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="首页"  href="//jqhee.github.io">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/JQHee">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                        <a title="微博" target="_blank" href="//weibo.com/u/3173517645">
                            <i class="fa fa-weibo fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-PHP/Mysql优化" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      Mysql优化
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/PHP/">PHP</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2018-05-09
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><h3 id="1-Mysql优化"><a href="#1-Mysql优化" class="headerlink" title="1.Mysql优化"></a>1.Mysql优化</h3><ul>
<li><a href="#Mysql_3NF">1.1 表的设计要合理(满足3NF)3范式</a></li>
<li><a href="#Mysql_index">1.2 创建适当索引[主键索引|唯一索引|普通索引|全文索引|空间索引]</a></li>
<li><a href="#Mysql_explain">1.3 对SQL语句优化 -&gt; 定位慢查询(explain(工具))</a></li>
<li><a href="#Mysql_table">1.4 使用分表技术(重点【水平分表、垂直分表】), 分区技术（了解）</a></li>
<li><a href="">1.5 读写分离（只要配置即可）</a></li>
<li><a href="">1.6 创建适当存储过程、函数、触发器</a></li>
<li><a href="#Mysql_myini">1.7 对my.ini优化，优化配置</a></li>
<li><a href="">1.8 软件硬件升级</a></li>
</ul>
<h4 id="1-1-表的设计要合理-满足3NF-3范式"><a href="#1-1-表的设计要合理-满足3NF-3范式" class="headerlink" title=" 1.1 表的设计要合理(满足3NF)3范式"></a><a id="Mysql_3NF"></a> 1.1 表的设计要合理(满足3NF)3范式</h4><p>1.1.1 概述：目前我们表的设计，最高级别的范式是”6NF”,对PHP程序员来说，我们的表满足3FN即可。</p>
<p>1.1.2 1NF</p>
<ul>
<li>(1)指表的属性（列）有原子性，即表的列不能再分了。（列本身含义精准）</li>
<li>(2)不能有重复的列</li>
</ul>
<p>特殊：</p>
<ul>
<li>只要是关系型数据库，就天然满足1NF</li>
</ul>
<p>1.1.3 2NF</p>
<ul>
<li>所谓2NF是指在我们表中不能存在一条完全相同的记录，一般通过设置一个主键，而该主键是自增的。</li>
</ul>
<p>1.1.4 3NF</p>
<ul>
<li>所谓3NF是指，如果列的内容可以推导（显式推导，隐式推导）出，那就不要单独一列存放。（例如外键即可以推导出信息）</li>
</ul>
<p>1.1.5 反3NF</p>
<ul>
<li>在通常情况下，我们的表的设计要严格遵守3NF,但也有例外，反而提高查询的效率。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 相册 (views浏览的总次数)</span><br><span class="line">id name views</span><br><span class="line"></span><br><span class="line">// 相册的流量图片 （当有人查看图片，通过触发器更新相册浏览的总次数+1）</span><br><span class="line">id name views</span><br></pre></td></tr></table></figure>
<h4 id="1-2-创建适当索引-主键索引-唯一索引-普通索引-全文索引-空间索引"><a href="#1-2-创建适当索引-主键索引-唯一索引-普通索引-全文索引-空间索引" class="headerlink" title=" 1.2 创建适当索引[主键索引|唯一索引|普通索引|全文索引|空间索引]"></a><a id="Mysql_inde"></a> 1.2 创建适当索引[主键索引|唯一索引|普通索引|全文索引|空间索引]</h4><p>1.2.0 构建海量表，定位慢查询</p>
<ul>
<li>为了讲解这个优化，我们需要构建一个海量表（800000），而且每条数据不一样。这时我们需要存储过程完成任务<ul>
<li>构建海量表</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">#创建表DEPT  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">CREATE TABLE dept( /*部门表*/  </span><br><span class="line">deptno MEDIUMINT   UNSIGNED  NOT NULL  DEFAULT 0,  </span><br><span class="line">dname VARCHAR(20)  NOT NULL  DEFAULT &quot;&quot;,  </span><br><span class="line">loc VARCHAR(13) NOT NULL DEFAULT &quot;&quot;  </span><br><span class="line">) ENGINE=MyISAM DEFAULT CHARSET=utf8 ;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">#创建表EMP雇员  </span><br><span class="line">CREATE TABLE emp  </span><br><span class="line">(empno  MEDIUMINT UNSIGNED  NOT NULL  DEFAULT 0,  </span><br><span class="line">ename VARCHAR(20) NOT NULL DEFAULT &quot;&quot;,  </span><br><span class="line">job VARCHAR(9) NOT NULL DEFAULT &quot;&quot;,  </span><br><span class="line">mgr MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,  </span><br><span class="line">hiredate DATE NOT NULL,  </span><br><span class="line">sal DECIMAL(7,2)  NOT NULL,  </span><br><span class="line">comm DECIMAL(7,2) NOT NULL,  </span><br><span class="line">deptno MEDIUMINT UNSIGNED NOT NULL DEFAULT 0  </span><br><span class="line">)ENGINE=MyISAM DEFAULT CHARSET=utf8 ;  </span><br><span class="line">  </span><br><span class="line">#工资级别表  </span><br><span class="line">CREATE TABLE salgrade  </span><br><span class="line">(  </span><br><span class="line">grade MEDIUMINT UNSIGNED NOT NULL DEFAULT 0,  </span><br><span class="line">losal DECIMAL(17,2)  NOT NULL,  </span><br><span class="line">hisal DECIMAL(17,2)  NOT NULL  </span><br><span class="line">)ENGINE=MyISAM DEFAULT CHARSET=utf8;  </span><br><span class="line">  </span><br><span class="line">INSERT INTO salgrade VALUES (1,700,1200);  </span><br><span class="line">INSERT INTO salgrade VALUES (2,1201,1400);  </span><br><span class="line">INSERT INTO salgrade VALUES (3,1401,2000);  </span><br><span class="line">INSERT INTO salgrade VALUES (4,2001,3000);  </span><br><span class="line">INSERT INTO salgrade VALUES (5,3001,9999);  </span><br><span class="line">  </span><br><span class="line"># 随机产生字符串  </span><br><span class="line">#定义一个新的命令结束符合  </span><br><span class="line">delimiter $$  </span><br><span class="line">#删除自定的函数  </span><br><span class="line">drop  function rand_string $$  </span><br><span class="line">  </span><br><span class="line">#这里我创建了一个函数.  </span><br><span class="line">  </span><br><span class="line">create function rand_string(n INT)  </span><br><span class="line">returns varchar(255)  </span><br><span class="line">begin  </span><br><span class="line"> declare chars_str varchar(100) default  </span><br><span class="line">   &apos;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&apos;;  </span><br><span class="line"> declare return_str varchar(255) default &apos;&apos;;  </span><br><span class="line"> declare i int default 0;  </span><br><span class="line"> while i &lt; n do  </span><br><span class="line">   set return_str =concat(return_str,substring(chars_str,floor(1+rand()*52),1));  </span><br><span class="line">   set i = i + 1;  </span><br><span class="line">   end while;  </span><br><span class="line">  return return_str;  </span><br><span class="line">  end $$  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">delimiter ;  </span><br><span class="line">select rand_string(6);  </span><br><span class="line">  </span><br><span class="line"># 随机产生部门编号  </span><br><span class="line">delimiter $$  </span><br><span class="line">drop  function rand_num $$  </span><br><span class="line">  </span><br><span class="line">#这里我们又自定了一个函数  </span><br><span class="line">create function rand_num( )  </span><br><span class="line">returns int(5)  </span><br><span class="line">begin  </span><br><span class="line"> declare i int default 0;  </span><br><span class="line"> set i = floor(10+rand()*500);  </span><br><span class="line">return i;  </span><br><span class="line">  end $$  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">delimiter ;  </span><br><span class="line">select rand_num();  </span><br><span class="line">  </span><br><span class="line">#******************************************  </span><br><span class="line">#向emp表中插入记录(海量的数据)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">delimiter $$  </span><br><span class="line">drop procedure insert_emp $$  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">create procedure insert_emp(in start int(10),in max_num int(10))  </span><br><span class="line">begin  </span><br><span class="line">declare i int default 0;  </span><br><span class="line"> set autocommit = 0;    </span><br><span class="line"> repeat  </span><br><span class="line"> set i = i + 1;  </span><br><span class="line"> insert into emp values ((start+i) ,rand_string(6),&apos;SALESMAN&apos;,0001,curdate(),2000,400,rand_num());  </span><br><span class="line">  until i = max_num  </span><br><span class="line"> end repeat;  </span><br><span class="line">   commit;  </span><br><span class="line"> end $$  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">delimiter ;  </span><br><span class="line">#调用刚刚写好的函数, 1800000条记录,从100001号开始  </span><br><span class="line">call insert_emp(100001,1800000);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">#**************************************************************  </span><br><span class="line">#  向dept表中插入记录  </span><br><span class="line">  </span><br><span class="line">delimiter $$  </span><br><span class="line">drop procedure insert_dept $$  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">create procedure insert_dept(in start int(10),in max_num int(10))  </span><br><span class="line">begin  </span><br><span class="line">declare i int default 0;  </span><br><span class="line"> set autocommit = 0;    </span><br><span class="line"> repeat  </span><br><span class="line"> set i = i + 1;  </span><br><span class="line"> insert into dept values ((start+i) ,rand_string(10),rand_string(8));  </span><br><span class="line">  until i = max_num  </span><br><span class="line"> end repeat;  </span><br><span class="line">   commit;  </span><br><span class="line"> end $$  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">delimiter ;  </span><br><span class="line">call insert_dept(100,10);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">#------------------------------------------------  </span><br><span class="line">#向salgrade 表插入数据  </span><br><span class="line">delimiter $$  </span><br><span class="line">drop procedure insert_salgrade $$  </span><br><span class="line">create procedure insert_salgrade(in start int(10),in max_num int(10))  </span><br><span class="line">begin  </span><br><span class="line">declare i int default 0;  </span><br><span class="line"> set autocommit = 0;  </span><br><span class="line"> ALTER TABLE emp DISABLE KEYS;    </span><br><span class="line"> repeat  </span><br><span class="line"> set i = i + 1;  </span><br><span class="line"> insert into salgrade values ((start+i) ,(start+i),(start+i));  </span><br><span class="line">  until i = max_num  </span><br><span class="line"> end repeat;  </span><br><span class="line">   commit;  </span><br><span class="line"> end $$  </span><br><span class="line">delimiter ;  </span><br><span class="line">#测试不需要了  </span><br><span class="line">#call insert_salgrade(10000,1000000);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">#----------------------------------------------</span><br></pre></td></tr></table></figure>
<ul>
<li>1.2.1 索引的创建</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 主键索引的创建</span><br><span class="line">主键索引的创建有两种形式：</span><br><span class="line">1.在创建表的时候，直接指定某列或者某几列为主键，这时就有主键索引</span><br><span class="line">2.添加表后，再指定主键索引</span><br><span class="line">// 1.直接创建主键索引</span><br><span class="line">create table aaa(id int primary key, name varchar(32) no null default &apos;&apos;);</span><br><span class="line">// 2.先创建表，再指定主键</span><br><span class="line">create table bbb(id int, name varchar(32) no null default &apos;&apos;);</span><br><span class="line">// 增加主键</span><br><span class="line">alert table 表名 add primarykey(列名1,列名2...);</span><br><span class="line">// 列如</span><br><span class="line">alert table bbb add primarykey(id);</span><br><span class="line">主键索引的特点：</span><br><span class="line">  - 一个表最多只能有一个主键</span><br><span class="line">  - 一个主键可以指向多列（复合主键）</span><br><span class="line">  - 主键索引的效率最高，因此我们应该id,一般id自增</span><br><span class="line">  - 主键不能不能重复，也不能为null</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 唯一索引的创建</span><br><span class="line">直接在创建表的时候，指定某一列或者某几列为唯一索引</span><br><span class="line">把表创建好后，再指定某一列或者某几列为唯一索引</span><br><span class="line">create unique index uni_email on ddd(email);</span><br><span class="line">alter table ddd add unique (email);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 普通索引的创建</span><br><span class="line">create index ind_name on eee (name);</span><br><span class="line">alter table eee add index (name);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 全文索引的创建（主要针对文章、汉字、英文的检索，可以快速检索到文章的关键词，数据表引擎myisam）</span><br><span class="line">FULLTEXT(title,body)</span><br><span class="line">// 使用</span><br><span class="line">select * from articles where match(title,body) against(&apos;database&apos;);</span><br><span class="line"></span><br><span class="line">解决mysql全文索引不支持中文的问题：</span><br><span class="line">1.使用mysql的一个中文全文插件mysqlcft  </span><br><span class="line">2.可以使用专门的中文检索引擎sphinx中文版（coreseek）</span><br><span class="line"></span><br><span class="line">特点：</span><br><span class="line">- mysql全文索引，只支持引擎myisam</span><br><span class="line">- mysql全文索引，默认只支持英文</span><br><span class="line">- 停止词，对应特别普通的字母不会见索引</span><br><span class="line">- 匹配度，按一定的概率来匹配</span><br></pre></td></tr></table></figure>
<ul>
<li>1.2.2 索引的的查询</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">desc 表名</span><br><span class="line">show keys from 表名\G</span><br><span class="line">show index from 表名\G</span><br><span class="line">show indexes from 表名\G</span><br></pre></td></tr></table></figure>
<ul>
<li>1.2.3 索引的的修改</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">先删除，再添加</span><br></pre></td></tr></table></figure>
<ul>
<li>1.2.4 索引的的删除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drop index 索引名 on 表名;</span><br><span class="line">alter table 表名 drop index 索引名;</span><br></pre></td></tr></table></figure>
<ul>
<li>1.2.5 索引的的原理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">btree(b树)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>1.2.6 索引的的注意事项</p>
</li>
<li><p>1.2.7 mysql优化</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">下列的几种情况有可能使用到索引：</span><br><span class="line">1.对于创建的队列（复合）索引，只要查询条件使用了最左边的列（dname）,索引一般就会被使用</span><br><span class="line">2.对于使用like查询，查询的结果是&apos;%aaa&apos;_不会使用索引 &apos;aaa%&apos;会使用到索引</span><br><span class="line">// 复合索引</span><br><span class="line">alter table dept add index (dname,loc);</span><br><span class="line"></span><br><span class="line">// 下列的表将不使用索引</span><br><span class="line">1.如果条件中有or,则要求or的所有字段都必须有索引，否则不能用索引。</span><br><span class="line">2.队列多列索引，不是使用第一部分，则不会使用索引</span><br><span class="line">3.like查询是以%开头</span><br><span class="line">4.如果类型是字符串，那一定要在条件中将数据使用引号引用起来，否则不使用索引。（添加时，字符串必须&quot;）</span><br><span class="line">5.如果mysql估计使用全表扫描使用索引快，则不使用索引。</span><br></pre></td></tr></table></figure>
<ul>
<li>1.2.8 管理员大批量导入数据（了解）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">对于MyISAM:</span><br><span class="line">alter table table_name disable keys; // 禁用所有的键，不然导入会很慢，一个检测</span><br><span class="line">loading data // insert语句</span><br><span class="line">alter table table_name enable keys;</span><br><span class="line"></span><br><span class="line">对于Innodb:</span><br><span class="line">1.将要导入的数据按照主键排序</span><br><span class="line">2.set unique_check=0; // 关闭唯一性校验</span><br><span class="line">3.set autocommit=0; // 关闭自动提交</span><br></pre></td></tr></table></figure>
<ul>
<li><p>1.2.9 选择合适的存储引擎</p>
<ul>
<li>MyISAM: 默认的Mysql存储引擎，如果应用是以读操作和插入为主，只有很少的更新和删除操作，并且对事务完整性不高，其优势访问速度快。（尤其适合论坛帖子/信息表/新闻/商品表）。</li>
<li>InnoDB: 提供了具有提交、回滚和崩溃恢复能力的事务安全，但是对于myisam,写的处理效率差一些并且占用更多的磁盘空间（如果对安全性要求高，则使用innodb）[账号、积分、余额]</li>
<li>Memory/heap [一些访问频繁，变化频繁，又没有必要入库的数据，比如用户的在线状态]，当mysql重启，表结构还在，数据已被清空</li>
</ul>
</li>
<li><p>1.3.0 选择合适的类型</p>
<ul>
<li>在精度要求高的应用中，建议使用<code>定点数</code>来存储数值，以保证结果的准确性。decimal不要用float</li>
<li>对于存储引擎是myisam的数据库，如果经常删除和修改记录的操作，要定时执行optimize table table_name;功能对表进行<code>碎片整理</code>。</li>
<li>日期类型要根据实际需要选择能够满足应用的最小存储日期的类型(msql int 和 php int数据类型长度不一样) Datetime</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 时间戳转</span><br><span class="line">$d = new DateTime(&apos;@21444444448&apos;);</span><br><span class="line">$d = setTimezone(new DateTimeZone(&apos;RPC&apos;));</span><br><span class="line">echo $d-&gt;format(&apos;Y-m-d H:i:s&apos;);</span><br><span class="line"></span><br><span class="line">// 转成时间戳 或者使用strtoTime(&apos;2019-08-01 19:33:20&apos;);</span><br><span class="line">$d = new DateTime(&apos;2019-08-01 19:33:20&apos;);</span><br><span class="line">echo $d -&gt; format(&apos;U&apos;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="1-3-对SQL语句优化-gt-定位慢查询-explain-工具"><a href="#1-3-对SQL语句优化-gt-定位慢查询-explain-工具" class="headerlink" title=" 1.3 对SQL语句优化 -&gt; 定位慢查询(explain(工具))"></a><a id="Mysql_explain"></a> 1.3 对SQL语句优化 -&gt; 定位慢查询(explain(工具))</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 方法一</span><br><span class="line">mysql&gt; show variables like &quot;%long%&quot;;  // 查看一下默认为慢查询的时间10秒</span><br><span class="line">mysql&gt; set global long_query_time=2;  // 设置成2秒，加上global,下次进mysql已然生效</span><br><span class="line">mysql&gt; show variables like &quot;%slow%&quot;;          //查看一下慢查询是不是已经开启 </span><br><span class="line">mysql&gt; set slow_query_log=&apos;ON&apos;;                        //加上global，不然会报错的。</span><br><span class="line">mysql&gt; set global slow_query_log=&apos;ON&apos;;            //启用慢查询 </span><br><span class="line">mysql&gt; show variables like &quot;%slow%&quot;;              //查看是否已经开启</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 方法2,修改mysql的配置文件my.cnfgeneral_log</span><br><span class="line">long_query_time = 2  </span><br><span class="line">log-slow-queries = /usr/local/mysql/mysql-slow.log  </span><br><span class="line"></span><br><span class="line">// 重启一下mysql服务</span><br><span class="line">/usr/local/mysql/libexec/mysqld restart</span><br><span class="line">[root@BlackGhost mysql]# cat mysql-slow.log     //查看命令</span><br></pre></td></tr></table></figure>
<h4 id="1-4-使用分表技术-重点【水平分表、垂直分表】-分区技术（了解）"><a href="#1-4-使用分表技术-重点【水平分表、垂直分表】-分区技术（了解）" class="headerlink" title=" 1.4 使用分表技术(重点【水平分表、垂直分表】), 分区技术（了解）"></a><a id="Mysql_table"> </a>1.4 使用分表技术(重点【水平分表、垂直分表】), 分区技术（了解）</h4><p>当一个表很大时，我们可以考虑添加索引，当索引都解决不了这个问题时，我们使用分表或者分区技术搞定。</p>
<p>1.4.1 水平分割表(大表和小表的结构一样的)<br>如QQ登录 <code>表qq_number(假如10G)</code> id  id%3<br>子表 <code>qq_number0</code>  <code>qq_number1</code> <code>qq_number2</code><br><code>create table  qq_number1 like qq_number0</code>;</p>
<p>// 注册，后台通过算法生成一个唯一id或者uuid<br>定表<code>$table_name = &quot;qq_number&quot;.$id%3</code>;</p>
<p>1.4.2 垂直分割表(了解)<br>所谓垂直分隔，就是把表中某个大字段（而且很少查询），单独取出放入另外一个表，并通过id关联<br>考试成绩表： id stuid questionid answer(大字段) grade (如：id=1)<br>学生表：stuid name<br>问题表：quetionid<br>answer(大字段)：id answer（如：id=1）</p>
<p>1.4.3 对表的分区（了解）</p>
<ul>
<li>分区允许根据指定的规则，跨文件系统分配单个表的多个部分，表的不同部分在不同的位置被存储为单独的表。MySQL从5.1.3开始支持Partition.</li>
<li>分表和分区的区别:</li>
</ul>
<p><br></p>
<table>
<thead>
<tr>
<th style="text-align:center">手动分表</th>
<th style="text-align:center">分区</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">多张数据表</td>
<td style="text-align:center">一张数据表</td>
</tr>
<tr>
<td style="text-align:center">重复数据的风险</td>
<td style="text-align:center">没有重复数据的风险</td>
</tr>
<tr>
<td style="text-align:center">写入多张表</td>
<td style="text-align:center">写入一张表</td>
</tr>
<tr>
<td style="text-align:center">没有统一的约束限制</td>
<td style="text-align:center">强制的约束限制</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>实际案例：每年作为一个分区<br>  当某个表海量，而且我们的查询条件按照日期来检索。</p>
<p>分区的限制：</p>
<ul>
<li>只能对数据表的整型列进行分区，或者数据列可以通过分区函数转化成整型列。</li>
<li>最大分区数目不能超过1024</li>
<li>如果含有唯一索引或者主键，则分区列必须包含所有的唯一索引或者主键在内。</li>
<li>不支持外键。</li>
<li>不支持全文索引（fulltext）</li>
<li>按日期进行分区非常适合，因为很多日期函数可以用。但是对于字符串来说，合适的分区函数不太多。</li>
</ul>
<h4 id="1-7-对my-ini优化，优化配置"><a href="#1-7-对my-ini优化，优化配置" class="headerlink" title=" 1.7 对my.ini优化，优化配置"></a><a id="Mysql_myini"></a> 1.7 对my.ini优化，优化配置</h4><ul>
<li>最主要的参数就是内存，我们主要用的innodb引擎，所以下面两个参数调得很大<ul>
<li><code>innodb_additional_mem_pool_size = 64M</code></li>
<li><code>innodb_buffer_pool_size = 1G</code></li>
</ul>
</li>
<li>对于myisam,需要调整<code>key_buffer_size</code>,当然调参数还是主要看状态，用<code>show status</code>语句查看当前状态，以决定改哪些参数</li>
<li>在<code>my.ini</code>修改端口3306，默认存储引擎和最大连接数 <code>max_connections 100 ==&gt; 调到2500</code></li>
<li><code>query_cache_size 100m</code></li>
</ul>

            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2018年05月14日 10:27</p>
        <p>原始链接： <a class="post-url" href="/2018/05/09/PHP/Mysql优化/" title="Mysql优化">https://jqhee.github.io/2018/05/09/PHP/Mysql优化/</a></p>
        <footer>
            <a href="https://jqhee.github.io">
                <img src="/images/logo.png" alt="hjq">
                hjq
            </a>
        </footer>
    </div>
</div>

      
        
            

        
    </div>
    <footer class="article-footer">
        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/PHP/" class="color4">PHP</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#目录"><span class="post-toc-text">目录</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-Mysql优化"><span class="post-toc-text">1.Mysql优化</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-1-表的设计要合理-满足3NF-3范式"><span class="post-toc-text"> 1.1 表的设计要合理(满足3NF)3范式</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-2-创建适当索引-主键索引-唯一索引-普通索引-全文索引-空间索引"><span class="post-toc-text"> 1.2 创建适当索引[主键索引|唯一索引|普通索引|全文索引|空间索引]</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-3-对SQL语句优化-gt-定位慢查询-explain-工具"><span class="post-toc-text"> 1.3 对SQL语句优化 -&gt; 定位慢查询(explain(工具))</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-4-使用分表技术-重点【水平分表、垂直分表】-分区技术（了解）"><span class="post-toc-text"> 1.4 使用分表技术(重点【水平分表、垂直分表】), 分区技术（了解）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-7-对my-ini优化，优化配置"><span class="post-toc-text"> 1.7 对my.ini优化，优化配置</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/2018/05/09/PHP/Mac 搭建PHP环境/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          Mac 搭建php开发环境
        
      </span>
    </a>
  
  
    <a href="/2018/05/09/PHP/Mysql的学习/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">Mysql学习</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2018 hjq<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "https://jqhee.github.io",
      animate: false,
      isHome: false,
      share: false,
      reward: 0
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/PHP/">PHP</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>首页</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>档案</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>








  <script src="/js/pop-img.js"></script>
  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>